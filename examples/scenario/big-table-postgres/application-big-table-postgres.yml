r2dbc:
  datasources:
    source:
      url: r2dbc:pool:postgresql://source-db:5432/db
      username: user
      password: password
      options: {}
    target:
      url: r2dbc:pool:postgresql://target-db:5432/db
      username: user
      password: password
      options: {}
reconciliation:
  datasets:
    all:
      source:
        datasourceRef: source
        query: >
          select id as MigrationKey, *
          from big_table
      target:
        datasourceRef: target
        query: >
          select id as MigrationKey, *
          from big_table
    both:
      source:
        datasourceRef: source
        query: >
          select id as MigrationKey, *
          from big_table where id between 50001 and 100000
      target:
        datasourceRef: target
        query: >
          select id as MigrationKey, *
          from big_table where id between 50001 and 100000
    source-only:
      source:
        datasourceRef: source
        query: >
          select id as MigrationKey, *
          from big_table where id between 1 and 50000
      target:
        datasourceRef: target
        query: >
          select id as MigrationKey, *
          from big_table where id between 1 and 50000
    target-only:
      source:
        datasourceRef: source
        query: >
          select id as MigrationKey, *
          from big_table where id between 100001 and 150000
      target:
        datasourceRef: target
        query: >
          select id as MigrationKey, *
          from big_table where id between 100001 and 150000
    counts:
      source:
        datasourceRef: source
        query: >
          select 'Num rows' as MigrationKey, count(*) from big_table
      target:
        datasourceRef: target
        query: >
          select 'Num rows' as MigrationKey, count(*) from big_table
